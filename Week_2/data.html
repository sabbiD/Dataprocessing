<!DOCTYPE html>
<html>
	<header>
	
		<h2 style="font-family:lucida console;font-size:100%"; align = "center">
			Sebile Demirtas </br>
			Temperature graph with Javascript </br>
			<a href="http://projects.knmi.nl/klimatologie/daggegevens/selectie.cgi">Source</a> </br></br>
		</h2>
	
	</header>
	<body>
<textarea id="rawdata">
20170401,  108
20170402,  103
20170403,   81
20170404,   98
20170405,   92
20170406,   81
20170407,  105
20170408,   96
20170409,  117
20170410,   98
20170411,   96
20170412,   98
20170413,   93
20170414,   99
20170415,   96
20170416,   79
20170417,   65
20170418,   61
20170419,   39
20170420,   69
20170421,  111
20170422,   78
20170423,   66
20170424,   93
20170425,   59
20170426,   50
20170427,   61
20170428,   76
20170429,   76
20170430,  123
20170501,  117
20170502,  100
20170503,  107
20170504,  104
20170505,   89
20170506,  128
20170507,  117
20170508,   97
20170509,   80
20170510,   90
20170511,  154
20170512,  155
20170513,  140
20170514,  134
20170515,  149
20170516,  204
20170517,  223
20170518,  165
20170519,  136
20170520,  125
20170521,  144
20170522,  176
20170523,  161
20170524,  159
20170525,  174
20170526,  203
20170527,  229
20170528,  205
20170529,  219
20170530,  183
20170531,  174
20170601,  166
20170602,  198
20170603,  184
20170604,  154
20170605,  171
20170606,  141
20170607,  140
20170608,  168
20170609,  165
20170610,  178
20170611,  199
20170612,  161
20170613,  163
20170614,  174
20170615,  200
20170616,  162
20170617,  186
20170618,  208
20170619,  236
20170620,  216
20170621,  214
20170622,  229
20170623,  196
20170624,  171
20170625,  175
20170626,  168
20170627,  173
20170628,  180
20170629,  175
20170630,  162
20170701,  161
20170702,  156
20170703,  166
20170704,  186
20170705,  190
20170706,  199
20170707,  206
20170708,  186
20170709,  172
20170710,  196
20170711,  177
20170712,  149
20170713,  146
20170714,  142
20170715,  172
20170716,  186
20170717,  186
20170718,  199
20170719,  235
20170720,  191
20170721,  182
20170722,  194
20170723,  160
20170724,  161
20170725,  167
20170726,  190
20170727,  185
20170728,  172
20170729,  182
20170730,  188
20170731,  181
20170801,  178
20170802,  176
20170803,  190
20170804,  183
20170805,  159
20170806,  158
20170807,  168
20170808,  162
20170809,  167
20170810,  157
20170811,  167
20170812,  168
20170813,  162
20170814,  179
20170815,  179
20170816,  176
20170817,  173
20170818,  169
20170819,  154
20170820,  158
20170821,  159
20170822,  182
20170823,  196
20170824,  179
20170825,  169
20170826,  182
20170827,  178
20170828,  187
20170829,  210
20170830,  178
20170831,  144
20170901,  147
20170902,  133
20170903,  130
20170904,  158
20170905,  186
20170906,  159
20170907,  156
20170908,  151
20170909,  132
20170910,  139
20170911,  141
20170912,  146
20170913,  141
20170914,  117
20170915,  125
20170916,  106
20170917,  108
20170918,  120
20170919,  120
20170920,  135
20170921,  134
20170922,  119
20170923,  109
20170924,  121
20170925,  142
20170926,  132
20170927,  136
20170928,  158
20170929,  171
20170930,  131
20171001,  141
20171002,  156
20171003,  136
20171004,  130
20171005,  129
20171006,  116
20171007,  122
20171008,  121
20171009,  121
20171010,  143
20171011,  148
20171012,  134
20171013,  153
20171014,  148
20171015,  158
20171016,  186
20171017,  129
20171018,  137
20171019,  157
20171020,  137
20171021,  132
20171022,  108
20171023,  126
20171024,  153
20171025,  142
20171026,  140
20171027,  118
20171028,  124
20171029,  107
20171030,   83
20171031,  101
20171101,  112
20171102,   98
20171103,   88
20171104,  106
20171105,   78
20171106,   48
20171107,   33
20171108,   59
20171109,   87
20171110,   92
20171111,   66
20171112,   52
20171113,   62
20171114,   77
20171115,   94
20171116,   93
20171117,   56
20171118,   69
20171119,   67
20171120,   78
20171121,  115
20171122,  114
20171123,  111
20171124,   69
20171125,   37
20171126,   53
20171127,   67
20171128,   54
20171129,   29
20171130,   15
20171201,    0
20171202,   -4
20171203,   37
20171204,   70
20171205,   76
20171206,   80
20171207,   59
20171208,   26
20171209,   21
20171210,   11
20171211,   -1
20171212,   18
20171213,   40
20171214,   33
20171215,   26
20171216,   27
20171217,   25
20171218,   59
20171219,   52
20171220,   75
20171221,   84
20171222,   86
20171223,   87
20171224,   82
20171225,   74
20171226,   58
20171227,   51
20171228,   39
20171229,   28
20171230,   88
20171231,  106
20180101,   68
20180102,   65
20180103,   88
20180104,   82
20180105,   64
20180106,   45
20180107,   10
20180108,   11
20180109,   30
20180110,   69
20180111,   57
20180112,   50
20180113,   42
20180114,   29
20180115,   52
20180116,   52
20180117,   46
20180118,   47
20180119,   37
20180120,   22
20180121,   30
20180122,   63
20180123,   81
20180124,  117
20180125,   77
20180126,   54
20180127,   58
20180128,   97
20180129,   88
20180130,   47
20180131,   65
20180201,   34
20180202,   44
20180203,   20
20180204,   17
20180205,   10
20180206,  -21
20180207,  -22
20180208,   10
20180209,    6
20180210,   29
20180211,   45
20180212,   30
20180213,   20
20180214,   19
20180215,   43
20180216,   32
20180217,    9
20180218,    7
20180219,   12
20180220,    8
20180221,    3
20180222,    2
20180223,   -5
20180224,   -4
20180225,  -22
20180226,  -33
20180227,  -36
20180228,  -66
20180301,  -47
20180302,  -37
20180303,  -17
20180304,   50
20180305,   66
20180306,   56
20180307,   59
20180308,   48
20180309,   65
20180310,  114
20180311,  102
20180312,  103
20180313,   56
20180314,   58
20180315,   73
20180316,   38
20180317,  -14
20180318,  -10
20180319,   -2
20180320,   38
20180321,   36
20180322,   64
20180323,   62
20180324,   65
20180325,   54
20180326,   47
20180327,   56
20180328,   59
20180329,   65
20180330,   90
20180331,   72
</textarea>
<p align="center">
	<canvas id="canvas" width="500" height="500">

		Temperature graph 2017-04-01 untill 2018-04-01

	</canvas>
</p>

<script>

//XMLHTTPRequest
//function reqListener () {
	//let data = this.responseText

	var data = document.getElementById("rawdata").value;

	// splitting data in document per line
	data = data.split("\n");

	// initialize lists
	datess = [];
	dates = [];
	temp = [];

	// change date format 
	for (let i = 0; i < data.length - 1; i++){

		datas = data[i].split(",");
		datum = datas[0];
		newdate = "";

		for (let i = 0; i < datum.length; i++){

			newdate += (datum[i]);

			if (i == 3 || i == 5){
				newdate += "-";
			}
		}

		// create date objects out of datess string
		datess[i] = new Date(newdate);

		// convert dates to milliseconds since 1970/01/01
		datee = datess[i].getTime();

		// use first date in data as reference point for days
		startDate = datess[0].getTime();

		// save days from 1 to 365 in dates list
		dates.push((datee/86400000 - startDate/86400000) + 1);

		// save temperatures in temp list
		temp.push(Number(datas[1]));
	}

	// initialize canvas 
	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");
	
	// gradient effect to lines
	var gradient=ctx.createLinearGradient(0,0,50,400);
	gradient.addColorStop("0.50","orange");
	gradient.addColorStop("1","blue");
	ctx.strokeStyle = gradient;
	ctx.font = '12pt lucida console';
	ctx.fillText("Max mean temperature in De Bilt (NL)", 100, 50);

	// print rotated text along y-axis
	ctx.save();
	ctx.translate(50, 50);
	ctx.rotate((Math.PI / 2));
	ctx.textAlign = "right";
	ctx.font = '11pt lucida console';
	ctx.fillText("Temperatures in 0,01Â°C", 395, 25);
	ctx.restore();
	
	// vertical line 
	drawLine(ctx,25,55,25,450);

	//horizontal line
	drawLine(ctx,25,450,400,450);

	// determine domains for Temperatures and Dates
	var domainDate = [Math.min.apply(null, dates), Math.max.apply(null, dates)]
	var domainTemp = [Math.min.apply(null, temp), Math.max.apply(null, temp)]

	// call function with domains
	var createDate = createTransform(domainDate, [25, 400]);
	var createTemp = createTransform(domainTemp, [400, 75]);

	// X coordinates of lines 
	var locationX = []

	// Y coordinates of lines
	var locationY = []

	// determine coordinates for every date 
	for (let i = 0; i < temp.length; i++){

		locationY[i] = createTemp(temp[i]);
		locationX[i] = createDate(dates[i]);
	}

	// initialize to draw temperature lines
	ctx.beginPath();
	ctx.lineCap="round";
	ctx.moveTo(locationX[0],locationY[0]);

	// drawing temperature lines 
	for (let i = 0; i < locationX.length; i++){
		
	 	ctx.lineTo(locationX[i],locationY[i]);
	 	ctx.stroke();
	}
	
	// initialize array with months to print on X-axis
	// retrieved from: https://www.w3schools.com/jsref/jsref_getmonth.asp 
	var month = new Array();
	month[0] = "Jan";
	month[1] = "Feb";
	month[2] = "March";
	month[3] = "April";
	month[4] = "May";
	month[5] = "June";
	month[6] = "July";
	month[7] = "August";
	month[8] = "Sept";
	month[9] = "Oct";
	month[10] = "Nov";
	month[11] = "Dec";

	// month and year on the horizontal axis with dashes
	for (let i = 0; i < datess.length ; i += 31){

		drawLine(ctx, locationX[i], 450, locationX[i], 460);
		ctx.font = 'bold 7pt lucida console';
		ctx.fillText(month[datess[i].getMonth()], locationX[i], 470);
		ctx.fillText(datess[i].getFullYear(), locationX[i], 480);
	}


	// temperature points on the vertical axis
	for (let i = -100, n = 450; i < 300; i += 50, n -= 450/8){
		
		drawLine(ctx, 15, n, 25, n);
		ctx.font = 'bold 7pt lucida console';
		ctx.fillText(i, 0, n);
	}
	
	function drawLine(ctx, startX, startY, endX, endY){
		ctx.beginPath();
		ctx.lineCap="round";
		ctx.moveTo(startX,startY);
		ctx.lineTo(endX,endY);
		ctx.stroke();
	}

	function createTransform(domain, range){
	// domain is a two-element array of the data bounds [domain_min, domain_max]
	// range is a two-element array of the screen bounds [range_min, range_max]

    var domain_min = domain[0]
    var domain_max = domain[1]
    var range_min = range[0]
    var range_max = range[1]
    
    // formulas to calculate the alpha and the beta
   	var alpha = (range_max - range_min) / (domain_max - domain_min)
    var beta = range_max - alpha * domain_max

    // returns the function for the linear transformation (y= a * x + b)
    return function(x){
      return alpha * x + beta;
    }
}
//}

//var url = "https://raw.githubusercontent.com/sabbiD/Dataprocessing/master/Week%202/KNMI_20180401.txt";
//var oReq = new XMLHttpRequest();
//oReq.addEventListener('load', reqListener);
//oReq.open("get", url, true);
//oReq.send();

</script> 
</body>
</html>